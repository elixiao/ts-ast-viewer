const C=/(\r?\n)/g;function I(a,e){return w(a,e).replace(C,"\\$1")}function w(a,e){if(e.length!==1)throw new Error("Specified char must be one character long.");let n="";for(let t=0;t<a.length;t++)a[t]===e&&(n+="\\"),n+=a[t];return n}function _(a){return a instanceof Function?a():a}var l;(function(a){a[a.Line=0]="Line",a[a.Star=1]="Star"})(l||(l={}));const i={BACK_SLASH:"\\".charCodeAt(0),FORWARD_SLASH:"/".charCodeAt(0),NEW_LINE:`
`.charCodeAt(0),CARRIAGE_RETURN:"\r".charCodeAt(0),ASTERISK:"*".charCodeAt(0),DOUBLE_QUOTE:'"'.charCodeAt(0),SINGLE_QUOTE:"'".charCodeAt(0),BACK_TICK:"`".charCodeAt(0),OPEN_BRACE:"{".charCodeAt(0),CLOSE_BRACE:"}".charCodeAt(0),DOLLAR_SIGN:"$".charCodeAt(0),SPACE:" ".charCodeAt(0),TAB:"	".charCodeAt(0)},S=new Set([i.BACK_SLASH,i.FORWARD_SLASH,i.NEW_LINE,i.CARRIAGE_RETURN,i.ASTERISK,i.DOUBLE_QUOTE,i.SINGLE_QUOTE,i.BACK_TICK,i.OPEN_BRACE,i.CLOSE_BRACE]);class f{constructor(e={}){Object.defineProperty(this,"_indentationText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_newLine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_useTabs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_quoteChar",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_indentNumberOfSpaces",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_currentIndentation",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_queuedIndentation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_queuedOnlyIfNotBlock",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_length",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_newLineOnNextWrite",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_currentCommentChar",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_stringCharStack",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_isInRegEx",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_isOnFirstLineOfBlock",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"_texts",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this._newLine=e.newLine||`
`,this._useTabs=e.useTabs||!1,this._indentNumberOfSpaces=e.indentNumberOfSpaces||4,this._indentationText=O(this._useTabs,this._indentNumberOfSpaces),this._quoteChar=e.useSingleQuote?"'":'"'}getOptions(){return{indentNumberOfSpaces:this._indentNumberOfSpaces,newLine:this._newLine,useTabs:this._useTabs,useSingleQuote:this._quoteChar==="'"}}queueIndentationLevel(e){return this._queuedIndentation=this._getIndentationLevelFromArg(e),this._queuedOnlyIfNotBlock=void 0,this}hangingIndent(e){return this._withResetIndentation(()=>this.queueIndentationLevel(this.getIndentationLevel()+1),e)}hangingIndentUnlessBlock(e){return this._withResetIndentation(()=>{this.queueIndentationLevel(this.getIndentationLevel()+1),this._queuedOnlyIfNotBlock=!0},e)}setIndentationLevel(e){return this._currentIndentation=this._getIndentationLevelFromArg(e),this}withIndentationLevel(e,n){return this._withResetIndentation(()=>this.setIndentationLevel(e),n)}_withResetIndentation(e,n){const t=this._getIndentationState();e();try{n()}finally{this._setIndentationState(t)}return this}getIndentationLevel(){return this._currentIndentation}block(e){return this._newLineIfNewLineOnNextWrite(),this.getLength()>0&&!this.isLastNewLine()&&this.spaceIfLastNot(),this.inlineBlock(e),this._newLineOnNextWrite=!0,this}inlineBlock(e){return this._newLineIfNewLineOnNextWrite(),this.write("{"),this._indentBlockInternal(e),this.newLineIfLastNot().write("}"),this}indent(e=1){return typeof e=="number"?(this._newLineIfNewLineOnNextWrite(),this.write(this._indentationText.repeat(e))):(this._indentBlockInternal(e),this.isLastNewLine()||(this._newLineOnNextWrite=!0),this)}_indentBlockInternal(e){this.getLastChar()!=null&&this.newLineIfLastNot(),this._currentIndentation++,this._isOnFirstLineOfBlock=!0,e!=null&&e(),this._isOnFirstLineOfBlock=!1,this._currentIndentation=Math.max(0,this._currentIndentation-1)}conditionalWriteLine(e,n){return e&&this.writeLine(_(n)),this}writeLine(e){return this._newLineIfNewLineOnNextWrite(),this.getLastChar()!=null&&this.newLineIfLastNot(),this._writeIndentingNewLines(e),this.newLine(),this}newLineIfLastNot(){return this._newLineIfNewLineOnNextWrite(),this.isLastNewLine()||this.newLine(),this}blankLineIfLastNot(){return this.isLastBlankLine()||this.blankLine(),this}conditionalBlankLine(e){return e&&this.blankLine(),this}blankLine(){return this.newLineIfLastNot().newLine()}conditionalNewLine(e){return e&&this.newLine(),this}newLine(){return this._newLineOnNextWrite=!1,this._baseWriteNewline(),this}quote(e){return this._newLineIfNewLineOnNextWrite(),this._writeIndentingNewLines(e==null?this._quoteChar:this._quoteChar+I(e,this._quoteChar)+this._quoteChar),this}spaceIfLastNot(){return this._newLineIfNewLineOnNextWrite(),this.isLastSpace()||this._writeIndentingNewLines(" "),this}space(e=1){return this._newLineIfNewLineOnNextWrite(),this._writeIndentingNewLines(" ".repeat(e)),this}tabIfLastNot(){return this._newLineIfNewLineOnNextWrite(),this.isLastTab()||this._writeIndentingNewLines("	"),this}tab(e=1){return this._newLineIfNewLineOnNextWrite(),this._writeIndentingNewLines("	".repeat(e)),this}conditionalWrite(e,n){return e&&this.write(_(n)),this}write(e){return this._newLineIfNewLineOnNextWrite(),this._writeIndentingNewLines(e),this}closeComment(){switch(this._currentCommentChar){case l.Line:this.newLine();break;case l.Star:this.isLastNewLine()||this.spaceIfLastNot(),this.write("*/");break}return this}unsafeInsert(e,n){const t=this._length,r=this._texts;if(s(),e===t)return this.write(n);return h(),this._length+=n.length,this;function s(){if(e<0)throw new Error(`Provided position of '${e}' was less than zero.`);if(e>t)throw new Error(`Provided position of '${e}' was greater than the text length of '${t}'.`)}function h(){const{index:o,localIndex:u}=L();if(u===0)r.splice(o,0,n);else if(u===r[o].length)r.splice(o+1,0,n);else{const d=r[o],c=d.substring(0,u),g=d.substring(u);r.splice(o,1,c,n,g)}}function L(){if(e<t/2){let o=0;for(let u=0;u<r.length;u++){const d=r[u],c=o;if(o+=d.length,o>=e)return{index:u,localIndex:e-c}}}else{let o=t;for(let u=r.length-1;u>=0;u--){const d=r[u];if(o-=d.length,o<=e)return{index:u,localIndex:e-o}}}throw new Error("Unhandled situation inserting. This should never happen.")}}getLength(){return this._length}isInComment(){return this._currentCommentChar!==void 0}isAtStartOfFirstLineOfBlock(){return this.isOnFirstLineOfBlock()&&(this.isLastNewLine()||this.getLastChar()==null)}isOnFirstLineOfBlock(){return this._isOnFirstLineOfBlock}isInString(){return this._stringCharStack.length>0&&this._stringCharStack[this._stringCharStack.length-1]!==i.OPEN_BRACE}isLastNewLine(){const e=this.getLastChar();return e===`
`||e==="\r"}isLastBlankLine(){let e=0;for(let n=this._texts.length-1;n>=0;n--){const t=this._texts[n];for(let r=t.length-1;r>=0;r--){const s=t.charCodeAt(r);if(s===i.NEW_LINE){if(e++,e===2)return!0}else if(s!==i.CARRIAGE_RETURN)return!1}}return!1}isLastSpace(){return this.getLastChar()===" "}isLastTab(){return this.getLastChar()==="	"}getLastChar(){const e=this._getLastCharCodeWithOffset(0);return e==null?void 0:String.fromCharCode(e)}endsWith(e){const n=this._length;return this.iterateLastCharCodes((t,r)=>{const s=n-r,h=e.length-s;return e.charCodeAt(h)!==t?!1:h===0?!0:void 0})||!1}iterateLastChars(e){return this.iterateLastCharCodes((n,t)=>e(String.fromCharCode(n),t))}iterateLastCharCodes(e){let n=this._length;for(let t=this._texts.length-1;t>=0;t--){const r=this._texts[t];for(let s=r.length-1;s>=0;s--){n--;const h=e(r.charCodeAt(s),n);if(h!=null)return h}}}toString(){if(this._texts.length>1){const e=this._texts.join("");this._texts.length=0,this._texts.push(e)}return this._texts[0]||""}_writeIndentingNewLines(e){if(e=e||"",e.length===0){t(this,"");return}e.split(f._newLineRegEx).forEach((r,s)=>{s>0&&this._baseWriteNewline(),r.length!==0&&t(this,r)});function t(r,s){r.isInString()||(r.isLastNewLine()||r.getLastChar()==null)&&r._writeIndentation(),r._updateInternalState(s),r._internalWrite(s)}}_baseWriteNewline(){this._currentCommentChar===l.Line&&(this._currentCommentChar=void 0);const e=this._stringCharStack[this._stringCharStack.length-1];(e===i.DOUBLE_QUOTE||e===i.SINGLE_QUOTE)&&this._getLastCharCodeWithOffset(0)!==i.BACK_SLASH&&this._stringCharStack.pop(),this._internalWrite(this._newLine),this._isOnFirstLineOfBlock=!1,this._dequeueQueuedIndentation()}_dequeueQueuedIndentation(){if(this._queuedIndentation==null)return;this._queuedOnlyIfNotBlock&&e(this)?(this._queuedIndentation=void 0,this._queuedOnlyIfNotBlock=void 0):(this._currentIndentation=this._queuedIndentation,this._queuedIndentation=void 0);function e(n){let t=!1;return n.iterateLastCharCodes(r=>{switch(r){case i.NEW_LINE:if(t)return!1;t=!0;break;case i.CARRIAGE_RETURN:return;case i.OPEN_BRACE:return!0;default:return!1}})}}_updateInternalState(e){for(let n=0;n<e.length;n++){const t=e.charCodeAt(n);if(!S.has(t))continue;const r=n===0?this._getLastCharCodeWithOffset(0):e.charCodeAt(n-1),s=n===0?this._getLastCharCodeWithOffset(1):n===1?this._getLastCharCodeWithOffset(0):e.charCodeAt(n-2);if(this._isInRegEx)if(r===i.FORWARD_SLASH&&s!==i.BACK_SLASH||r===i.NEW_LINE)this._isInRegEx=!1;else continue;else if(!this.isInString()&&!this.isInComment()&&b(t,r,s)){this._isInRegEx=!0;continue}if(this._currentCommentChar==null&&r===i.FORWARD_SLASH&&t===i.FORWARD_SLASH?this._currentCommentChar=l.Line:this._currentCommentChar==null&&r===i.FORWARD_SLASH&&t===i.ASTERISK?this._currentCommentChar=l.Star:this._currentCommentChar===l.Star&&r===i.ASTERISK&&t===i.FORWARD_SLASH&&(this._currentCommentChar=void 0),this.isInComment())continue;const h=this._stringCharStack.length===0?void 0:this._stringCharStack[this._stringCharStack.length-1];r!==i.BACK_SLASH&&(t===i.DOUBLE_QUOTE||t===i.SINGLE_QUOTE||t===i.BACK_TICK)?h===t?this._stringCharStack.pop():(h===i.OPEN_BRACE||h===void 0)&&this._stringCharStack.push(t):s!==i.BACK_SLASH&&r===i.DOLLAR_SIGN&&t===i.OPEN_BRACE&&h===i.BACK_TICK?this._stringCharStack.push(t):t===i.CLOSE_BRACE&&h===i.OPEN_BRACE&&this._stringCharStack.pop()}}_getLastCharCodeWithOffset(e){if(!(e>=this._length||e<0))for(let n=this._texts.length-1;n>=0;n--){const t=this._texts[n];if(e>=t.length)e-=t.length;else return t.charCodeAt(t.length-1-e)}}_writeIndentation(){const e=Math.floor(this._currentIndentation);this._internalWrite(this._indentationText.repeat(e));const n=this._currentIndentation-e;if(this._useTabs)n>.5&&this._internalWrite(this._indentationText);else{const t=Math.round(this._indentationText.length*n);let r="";for(let s=0;s<t;s++)r+=this._indentationText[s];this._internalWrite(r)}}_newLineIfNewLineOnNextWrite(){!this._newLineOnNextWrite||(this._newLineOnNextWrite=!1,this.newLine())}_internalWrite(e){e.length!==0&&(this._texts.push(e),this._length+=e.length)}_getIndentationLevelFromArg(e){if(typeof e=="number"){if(e<0)throw new Error("Passed in indentation level should be greater than or equal to 0.");return e}else if(typeof e=="string"){if(!f._spacesOrTabsRegEx.test(e))throw new Error("Provided string must be empty or only contain spaces or tabs.");const{spacesCount:n,tabsCount:t}=N(e);return t+n/this._indentNumberOfSpaces}else throw new Error("Argument provided must be a string or number.")}_setIndentationState(e){this._currentIndentation=e.current,this._queuedIndentation=e.queued,this._queuedOnlyIfNotBlock=e.queuedOnlyIfNotBlock}_getIndentationState(){return{current:this._currentIndentation,queued:this._queuedIndentation,queuedOnlyIfNotBlock:this._queuedOnlyIfNotBlock}}}Object.defineProperty(f,"_newLineRegEx",{enumerable:!0,configurable:!0,writable:!0,value:/\r?\n/});Object.defineProperty(f,"_spacesOrTabsRegEx",{enumerable:!0,configurable:!0,writable:!0,value:/^[ \t]*$/});function b(a,e,n){return e===i.FORWARD_SLASH&&a!==i.FORWARD_SLASH&&a!==i.ASTERISK&&n!==i.ASTERISK&&n!==i.FORWARD_SLASH}function O(a,e){return a?"	":Array(e+1).join(" ")}function N(a){let e=0,n=0;for(let t=0;t<a.length;t++){const r=a.charCodeAt(t);r===i.SPACE?e++:r===i.TAB&&n++}return{spacesCount:e,tabsCount:n}}export{f as C};
